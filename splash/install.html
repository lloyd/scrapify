<html>
<head>
<title>Mozilla Labs: Open Web Apps installer</title>
<script src="https://stage.myapps.mozillalabs.com/js/jquery-1.4.2.min.js"></script> 
<script src="https://stage.myapps.mozillalabs.com/jsapi/include.js"></script>
<body>

<div id="banner">Mozilla Labs</div>
<div id="body">
<p>Installing application - please click "Install" to proceed.</p>
<p><a href="{{ return_to }}">Return to origin page</a></p>
</div>
</body>
<script>

var query = window.location.search.substring(1);
var vars = query.split("&");
var args = {};
for (var i=0;i<vars.length;i++) {
  var pair = vars[i].split("=");
  args[pair[0]] = pair[1];
}

if (args.url)
{
  if (args.url("https://chrome.google.com/webstore") == 0)
  {
    // use convertcrx to turn it into an OpenWebApp manifest.
    manifestURL = "https://apphelper.mozillalabs.com/convertcrx?url=" + escape(args.url);
  } else {
    // otherwise we just wrap up the site with a manifest
    manifestURL = "https://apphelper.mozillalabs.com/appify?url=" + escape(args.url);
  }
  $(document).ready(function() {
    navigator.apps.install({url: manifestURL, callback: function(val) {
      window.location.href = "https://myapps.mozillalabs.com";
    }});
  });
}
</script>
</html>
